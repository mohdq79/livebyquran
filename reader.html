<!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="utf-8">
  <title>Live by Quran â€” Reader</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet">

  <style>
    /* reset */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: "Noto Sans Arabic", sans-serif; color:#fff; overflow-x:hidden; }

    /* fixed, full-screen bg layer */
    #bg-overlay {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background: #000 url("") center/cover no-repeat;
      transition: background 0.8s ease-out;
      z-index:-1;
    }

    /* container for all sections */
    #sections { position:relative; z-index:1; }

    /* each section box */
    .book-section {
      max-width:800px;
      margin:2rem auto;
      padding:2rem;
      background: rgba(0,0,0,0.4);
      border-radius:8px;
      line-height:1.7;
    }

    .section-title {
      font-family:"Noto Nastaliq Urdu", serif;
      font-size:2.2rem;
      margin-bottom:1rem;
    }

    .book-section p {
      margin-bottom:1.25rem;
      font-size:1rem;
    }

    .quran-verse {
      margin:1.5rem 0;
      padding:1rem 1.5rem;
      background:rgba(255,255,255,0.1);
      border-left:4px solid rgba(255,255,255,0.7);
      font-style:italic;
    }

    /* Mobile tweaks */
    @media (max-width:600px) {
      .book-section {
        margin:1rem;
        padding:1rem;
      }
      .section-title { font-size:1.8rem; }
      .book-section p { font-size:0.95rem; }
    }

    /* header/nav */
    header {
      position:fixed; top:0; left:0; right:0;
      background:rgba(255,255,255,0.9);
      color:#333; display:flex; align-items:center;
      padding:0.5rem 1rem; z-index:2;
      font-family:sans-serif;
    }
    header img { height:40px; }
    header nav { margin-left:auto; }
    header nav a {
      margin-left:1rem; text-decoration:none; color:#333;
      font-weight:500;
    }
    header nav a:hover { text-decoration:underline; }
  </style>
</head>

<body>

  <div id="bg-overlay"></div>

  <header>
    <a href="index.html"><img src="Livebyquran Logo.PNG" alt="Live by Quran"></a>
    <nav>
      <a href="index.html">Home</a>
      <a href="books.html">Books</a>
      <a href="lectures.html">Lectures</a>
      <a href="articles.html">Articles</a>
      <a href="qa.html">Q&A</a>
    </nav>
  </header>

  <div id="sections"></div>

  <script>
    (async()=>{
      // 1) grab 'slug' param:
      const params = new URLSearchParams(location.search);
      const slug = params.get('slug');
      if(!slug) {
        document.getElementById('sections').innerHTML =
          '<p style="padding:2rem;text-align:center;color:#ccc;">No book specified.</p>';
        return;
      }

      const base = `assets/books/${slug}`;
      // 2) load sections.json
      let conf;
      try {
        conf = await fetch(`${base}/sections.json`).then(r=>r.json());
      } catch(err) {
        console.error(err);
        return document.getElementById('sections')
          .innerHTML = `<p style="padding:2rem;color:#fcc;">Failed to load sections.json</p>`;
      }

      const container = document.getElementById('sections');
      // 3) for each section: fetch its HTML, inject, and record its bg
      const sections = [];
      for(const sec of conf.sections){
        const html = await fetch(`${base}/${sec.file}`).then(r=>r.text());
        const div = document.createElement('div');
        div.className = 'book-section';
        div.id = sec.slug;
        div.innerHTML = html;
        container.appendChild(div);
        sections.push({
          el: div,
          bg: `${base}/chapters/${sec.bg}`
        });
      }

      const bgOverlay = document.getElementById('bg-overlay');
      // initially set to the first section's bg
      bgOverlay.style.backgroundImage = `url('${sections[0].bg}')`;

      // 4) as you scroll, swap the background
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting) {
            const idx = sections.findIndex(s=>s.el===e.target);
            bgOverlay.style.backgroundImage = `url('${sections[idx].bg}')`;
          }
        });
      },{ rootMargin:'-50% 0px -50% 0px' });

      sections.forEach(s => io.observe(s.el));

    })();
  </script>
</body>
</html>
