<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Live by Quran – Reader</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New&family=Playfair+Display&family=Calibri&display=swap" rel="stylesheet">
  <style>
    /* —— Reset —— */
    * { margin:0; padding:0; box-sizing:border-box }
    html, body { height:100%; overflow-x:hidden }

    /* —— Parallax sections —— */
    section.parallax {
      position: relative;
      width:100%;
      height:100vh;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    /* semi-transparent overlay so white text shows up */
    section.parallax::before {
      content:""; position:absolute;
      inset:0;
      background:rgba(0,0,0,0.4);
    }

    /* —— Text container —— */
    .text {
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      max-width:800px;
      padding:2rem;
      color:#fff;
      font-family:Calibri, sans-serif;
      line-height:1.6;
      text-shadow:1px 1px 4px rgba(0,0,0,0.7);
    }
    .text h1 {
      font-family:'Playfair Display',serif;
      font-size:2.5rem; margin-bottom:1rem;
    }
    .text p {
      margin-bottom:1rem;
    }
    .text .arabic {
      font-family:'Scheherazade New',serif;
      font-size:1.8rem;
      margin-bottom:1rem;
      text-align:right;
      direction:rtl;
    }

    /* —— Back button —— */
    header {
      position:fixed; top:0; left:0; width:100%;
      padding:10px 20px; z-index:10;
      display:flex; align-items:center;
      background:rgba(0,0,0,0.5);
    }
    header a {
      color:#fff; font-size:1rem;
      text-decoration:none; margin-right:1rem;
    }
  </style>
</head>
<body>

  <header>
    <a href="books.html">← Back to Books</a>
    <span id="book-title" style="color:#fff; font-weight:bold;"></span>
  </header>

  <div id="container"><!-- JS will inject sections here --></div>

  <script>
    // 1) read slug from query
    const params = new URLSearchParams(location.search)
    const slug = params.get('slug') || ''

    // 2) map each slug to its chapter images
    const chapters = {
      'fa-inni-qarib-urdu': [
        'chap1.jpg',
        'chap2.jpg',
        'chap3.jpg'
      ],
      'fa-inni-qarib-eng': [
        'eng1.jpg',
        'eng2.jpg',
        'eng3.jpg'
      ],
      'parables-urdu': [
        'p1.jpg',
        'p2.jpg',
        'p3.jpg'
      ]
    }

    // 3) load preface.txt + render first section
    async function loadPreface() {
      const txt = await fetch(`assets/books/${slug}/preface.txt`).then(r=>r.text())
      renderSection({
        bg:`assets/books/${slug}/cover.png`,
        html:`<div class="text"><h1>${txt.split('\n')[0]}</h1>
               ${txt.split('\n').slice(1).map(p=>`<p>${p}</p>`).join('')}
             </div>`
      })
      document.getElementById('book-title').textContent = slug.replace(/-/g,' ')
    }

    // 4) render a parallax section
    function renderSection({bg, html}) {
      const sec = document.createElement('section')
      sec.className = 'parallax'
      sec.style.backgroundImage = `url('${bg}')`
      sec.innerHTML = html
      document.getElementById('container').appendChild(sec)
    }

    // 5) after preface, render each chapter image
    async function loadChapters() {
      const imgs = chapters[slug]||[]
      for (let img of imgs) {
        renderSection({
          bg:`assets/books/${slug}/chapters/${img}`,
          html:`<div class="text">
                  <!-- you could also overlay a caption here -->
                </div>`
        })
      }
    }

    // kick it off
    loadPreface()
      .then(loadChapters)
      .catch(e=>{
        document.body.innerHTML = `<p style="color:red; padding:2rem;">
          Error loading book data. Make sure <code>assets/books/${slug}/</code> exists.
        </p>`
        console.error(e)
      })
  </script>
</body>
</html>
