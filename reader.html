<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Live by Quran — Reader</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Load Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?
      family=Playfair+Display:wght@700&
      family=Noto+Nastaliq+Urdu&display=swap"
        rel="stylesheet" />

  <style>
    /*── Reset & Base ──*/
    * { margin:0; padding:0; box-sizing:border-box }
    html, body { height:100%; overflow-x:hidden; font-family:Calibri,sans-serif; }

    /*── Sticky Header ──*/
    header {
      position:fixed; top:0; left:0; right:0;
      height:60px; background:rgba(255,255,255,0.85);
      display:flex; align-items:center; padding:0 20px;
      font-family:'Playfair Display',serif;
      z-index:100; box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    header a { text-decoration:none; color:#333; margin-right:1em; }
    header .title { flex:1; text-align:center; font-size:1.1rem; }

    /*── Parallax Background ──*/
    #bg {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background-size:cover; background-position:center;
      will-change:transform; z-index:-1;
    }

    /*── Content Container ──*/
    #reader {
      position:relative; margin-top:60px; /* allow for header */
      padding:40px 20px; max-width:800px; margin-left:auto; margin-right:auto;
      color:#fff;
    }

    /*── Text Overlay Box ──*/
    .overlay {
      background:rgba(0,0,0,0.6);
      padding:2rem; border-radius:8px;
      line-height:1.6;
    }
    .overlay h1 {
      font-family:'Playfair Display',serif;
      font-size:2.5rem; margin-bottom:1rem;
    }
    .overlay p {
      font-family:'Noto Nastaliq Urdu',serif;
      font-size:1.3rem;
      margin-bottom:1rem;
      text-align:right;
      direction:rtl;
    }
  </style>
</head>

<body>
  <header>
    <a href="books.html">← Back to Books</a>
    <div class="title" id="book-title">Loading…</div>
  </header>

  <div id="bg"></div>
  <div id="reader">
    <div class="overlay" id="preface-container">
      <!-- Preface text will inject here -->
    </div>
  </div>

  <script>
    (async()=>{
      // 1. Grab the slug from the URL (?slug=parables-urdu)
      const params = new URLSearchParams(location.search);
      const slug   = params.get('slug');
      if(!slug) {
        alert('Reader requires ?slug=<your-book-slug>');
        return;
      }
      // 2. Set the header title
      document.getElementById('book-title').textContent =
        slug.replace(/-/g,' ').replace(/\b\w/g,c=>c.toUpperCase());

      // 3. Point the background to your bg.jpg
      const bg = document.getElementById('bg');
      bg.style.backgroundImage =
        `url("assets/books/${slug}/chapters/bg.jpg")`;

      // 4. Load & render preface.txt
      const raw = await fetch(`assets/books/${slug}/preface.txt`)
                      .then(r=>r.text());
      // Split on double-newlines, wrap each in <p>
      const html = raw.trim()
        .split(/\n\s*\n/)
        .map(para =>
          `<p>${para.trim().replace(/\n/g,'<br>')}</p>`
        ).join('');
      document.getElementById('preface-container').innerHTML =
        `<h1>پیش لفظ</h1>${html}`;

      // 5. Parallax scroll: bg moves at 30% of scroll speed
      window.addEventListener('scroll',()=>{
        const y = window.scrollY;
        bg.style.transform = `translateY(${y*0.3}px)`;
      });
    })().catch(err=>{
      console.error(err);
      alert('Error loading book preview: '+err.message);
    });
  </script>
</body>
</html>
