<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>Live by Quran — Reader</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Nastaliq & Sans-Serif Web Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?
      family=Noto+Nastaleeq+Urdu&family=Noto+Sans+Arabic:wght@400;700&display=swap"
    rel="stylesheet">

  <style>
    /*── Reset & Base ──*/
    * { margin:0; padding:0; box-sizing:border-box }
    html, body { height:100%; overflow-x:hidden; font-family:"Noto Sans Arabic",sans-serif; }
    body { background:#000; }

    /*── Full-screen Background Overlay ──*/
    #bg-overlay {
      position:fixed; inset:0;
      background:#000 center/cover no-repeat;
      transition: background 0.8s ease-out;
      z-index:-1;
    }

    /*── Header/Nav (identical to main site) ──*/
    header {
      position:fixed; top:0; inset-inline-start:0; inset-inline-end:0;
      height:56px; background:rgba(255,255,255,0.95);
      display:flex; align-items:center; padding-inline:1rem;
      box-shadow:0 2px 4px rgba(0,0,0,0.1); z-index:100;
    }
    header .logo img { height:36px; }
    nav { margin-inline-start:auto; display:flex; gap:1rem; }
    nav a {
      text-decoration:none; color:#333;
      font-weight:500; transition:color .2s;
    }
    nav a:hover { color:#000; }

    /*── Section Container ──*/
    #sections { padding-block-start:56px; }

    .book-section {
      max-inline-size:800px;
      margin:2rem auto;
      padding:1.5rem;
      background:rgba(255,255,255,0.85);
      border-radius:8px;
      line-height:1.8;
      font-family:"Noto Nastaleeq Urdu", serif;
      color:#111;
    }
    .section-title {
      font-size:1.8rem;
      margin-block-end:1rem;
      font-weight:bold;
      text-align:center;
    }
    .book-section p {
      margin-block-end:1rem;
      font-size:1rem;
    }
    .quran-verse {
      margin-block:1rem;
      padding-block:0.75rem;
      padding-inline:1rem;
      background:rgba(0,0,0,0.05);
      border-inline-start:4px solid #888;
      font-style:italic;
    }

    /*── Mobile Adjustments ──*/
    @media(max-width:600px) {
      .book-section { margin:1rem; padding:1rem; }
      .section-title { font-size:1.5rem; }
      .book-section p { font-size:0.95rem; }
    }
  </style>
</head>

<body>
  <div id="bg-overlay"></div>

  <header>
    <a href="index.html" class="logo">
      <img src="Livebyquran Logo.PNG" alt="Live by Quran">
    </a>
    <nav>
      <a href="index.html">صفحۂ اول</a>
      <a href="books.html">کتب</a>
      <a href="lectures.html">لیکچرز</a>
      <a href="articles.html">مضامین</a>
      <a href="qa.html">سوال و جواب</a>
    </nav>
  </header>

  <div id="sections"></div>

  <script>
    (async ()=>{
      // 1. Read slug
      const params = new URLSearchParams(location.search);
      const slug   = params.get('slug');
      if(!slug) {
        document.getElementById('sections').innerHTML =
          '<p style="padding:2rem; text-align:center; color:#eee;">' +
          'کتاب منتخب نہیں کی گئی۔</p>';
        return;
      }

      const base = `assets/books/${slug}`;
      // 2. Load sections.json
      let config;
      try {
        config = await fetch(`${base}/sections.json`)
          .then(r=>r.ok?r.json():Promise.reject('sections.json نہیں ملا'));
      } catch(e) {
        console.error(e);
        document.getElementById('sections').innerHTML =
          '<p style="padding:2rem; text-align:center; color:salmon;">' +
          'سیکشن کنفیگریشن لوڈ کرنے میں مسئلہ۔</p>';
        return;
      }

      const container = document.getElementById('sections');
      const sections  = [];

      // 3. Inject each snippet + record its bg
      for (let s of config.sections) {
        // Content snippet
        let html = '';
        try {
          html = await fetch(`${base}/${s.file}`)
            .then(r=>r.ok?r.text():Promise.reject(s.file+' نہیں ملا'));
        } catch(err) {
          html = `<p style="color:red;">${err} لوڈ نہیں ہو سکا۔</p>`;
        }
        const sec = document.createElement('div');
        sec.className = 'book-section';
        sec.innerHTML = html;
        container.appendChild(sec);

        // record for bg swap
        sections.push({
          element: sec,
          bg:      `${base}/chapters/${s.bg}`
        });
      }

      // 4. Initial bg
      const overlay = document.getElementById('bg-overlay');
      overlay.style.backgroundImage = `url("${sections[0].bg}")`;

      // 5. Swap on scroll center
      const observer = new IntersectionObserver((entries)=>{
        for (let ent of entries) {
          if(ent.isIntersecting) {
            const idx = sections.findIndex(x=>x.element===ent.target);
            overlay.style.backgroundImage = `url("${sections[idx].bg}")`;
          }
        }
      }, {
        rootMargin: '-50% 0px -50% 0px'
      });

      sections.forEach(s => observer.observe(s.element));
    })();
  </script>
</body>
</html>
